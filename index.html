<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>抽奖系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            min-height: 100vh;
            background: #f3f4f6;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 32px 16px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            font-size: 28px;
            color: #1f2937;
            margin-bottom: 32px;
        }
        
        /* 充值按钮 */
        .recharge-section {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }
        
        .btn-recharge {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 32px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .btn-recharge:hover {
            background: #2563eb;
        }
        .btn-jiezhang {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 32px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            margin-left: 10px;
        }
        
        .btn-jiezhang:hover {
            background: #2563eb;
        }
        
        /* 金额显示 */
        .amount-section {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }
        
        .amount-box {
            background: white;
            border-radius: 12px;
            padding: 20px 32px;
            text-align: center;
            min-width: 140px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .amount-label {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .amount-value {
            font-size: 24px;
            font-weight: bold;
        }
        
        .amount-value.blue { color: #3b82f6; }
        .amount-value.red { color: #ef4444; }
        .amount-value.green { color: #10b981; }
        .amount-value.yellow { color: #ffff00; }
        /* 抽奖区域 */
        .lottery-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .lottery-title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #374151;
            margin-bottom: 20px;
        }
        
        .lottery-row {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .btn-lottery {
            width: 72px;
            height: 44px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-lottery.green {
            background: #22c55e;
            color: white;
        }
        
        .btn-lottery.green:hover {
            background: #16a34a;
        }
        
        .btn-lottery.red {
            background: #ef4444;
            color: white;
            cursor: not-allowed;
        }
        
        /* 弹窗 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: 12px;
            padding: 24px;
            min-width: 320px;
            max-width: 90%;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 16px;
            color: #1f2937;
        }
        
        .modal-content {
            margin-bottom: 20px;
        }
        
        .modal-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            margin-top: 8px;
        }
        
        .modal-input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .error-msg {
            color: #ef4444;
            font-size: 13px;
            margin-top: 6px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-outline {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .btn-outline:hover {
            background: #f3f4f6;
        }
        
        .result-text {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .result-bonus {
            text-align: center;
            font-size: 18px;
            color: #ef4444;
            margin-top: 8px;
        }
        
        .balance-info {
            text-align: center;
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .balance-info span {
            font-weight: bold;
            color: #10b981;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>抽奖系统</h1>
        
        <!-- 充值按钮 -->
        <div class="recharge-section">
            <button class="btn-recharge" onclick="showPasswordModal()">充值</button>
            <button class="btn-jiezhang" onclick="showPasswordModal2()">结账</button>
        </div>
        
        <!-- 金额显示 -->
        <div class="amount-section">
            <div class="amount-box">
                <div class="amount-label">充值金额</div>
                <div class="amount-value blue" id="rechargeAmount">0</div>
            </div>
            <div class="amount-box">
                <div class="amount-label">中奖金额</div>
                <div class="amount-value red" id="winAmount">0</div>
            </div>
            <div class="amount-box">
                <div class="amount-label">余额</div>
                <div class="amount-value green" id="balance">0</div>
            </div>
            <div class="amount-box">
                <div class="amount-label">抽奖次数</div>
                <div class="amount-value yellow" id="countme">0</div>
            </div>
        </div>
        
        <!-- 抽奖区域 -->
        <div class="lottery-section">
            <div class="lottery-title">抽奖区域</div>
            <div id="lotteryGrid"></div>
        </div>
    </div>
    
    <!-- 密码弹窗 -->
    <div class="modal-overlay" id="passwordModal">
        <div class="modal">
            <div class="modal-title">请输入密码</div>
            <div class="modal-content">
                <input type="password" class="modal-input" id="passwordInput" placeholder="请输入密码" onkeypress="if(event.key==='Enter')checkPassword()">
                <div class="error-msg" id="passwordError"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('passwordModal')">取消</button>
                <button class="btn btn-primary" onclick="checkPassword()">确认</button>
            </div>
        </div>
    </div>
     <!-- 密码弹窗2 -->
    <div class="modal-overlay" id="passwordModal2">
        <div class="modal">
            <div class="modal-title">请输入密码</div>
            <div class="modal-content">
                <input type="password" class="modal-input" id="passwordInput2" placeholder="请输入密码" onkeypress="if(event.key==='Enter')checkPassword2()">
                <div class="error-msg" id="passwordError2"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('passwordModal2')">取消</button>
                <button class="btn btn-primary" onclick="checkPassword2()">确认</button>
            </div>
        </div>
    </div>
    
    <!-- 金额弹窗 -->
    <div class="modal-overlay" id="amountModal">
        <div class="modal">
            <div class="modal-title">请输入充值金额</div>
            <div class="modal-content">
                <input type="number" class="modal-input" id="amountInput" placeholder="请输入金额" onkeypress="if(event.key==='Enter')confirmRecharge()">
                <div class="error-msg" id="amountError"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('amountModal')">取消</button>
                <button class="btn btn-primary" onclick="confirmRecharge()">确认</button>
            </div>
        </div>
    </div>
     <!-- 结账弹窗 -->
    <div class="modal-overlay" id="jiezhangModal">
        <div class="modal">
            <div class="modal-title">是否结账</div>
            <div class="modal-content">
                <div class="amount-label">当前余额为：</div>
                <div class="amount-value green" id="balance2">0</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('jiezhangModal')">否</button>
                <button class="btn btn-primary" onclick="confirmJiezhang()">是</button>
            </div>
        </div>
    </div>
    <!-- 余额不足弹窗 -->
    <div class="modal-overlay" id="noBalanceModal">
        <div class="modal">
            <div class="modal-title">提示</div>
            <div class="modal-content">
                <p class="result-text">当前余额小于2元，无法抽奖</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('noBalanceModal')">确定</button>
            </div>
        </div>
    </div>
    
    <!-- 抽奖确认弹窗 -->
    <div class="modal-overlay" id="confirmLotteryModal">
        <div class="modal">
            <div class="modal-title">确认抽奖</div>
            <div class="modal-content">
                <p class="balance-info">当前余额：<span id="confirmBalance">0</span></p>
                <p class="balance-info">是否花费 2 元进行抽奖？</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('confirmLotteryModal')">取消</button>
                <button class="btn btn-primary" onclick="doLottery()">确认</button>
            </div>
        </div>
    </div>
    
    <!-- 抽奖结果弹窗 -->
    <div class="modal-overlay" id="resultModal">
        <div class="modal">
            <div class="modal-title">抽奖结果</div>
            <div class="modal-content">
                <p class="result-text" id="resultText"></p>
                <p class="result-bonus" id="resultBonus"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeResult()">关闭</button>
            </div>
        </div>
    </div>

    <script>
        // 数据状态
        let rechargeAmount = 0;
        let winAmount = 0;
        let balance = 0;
        let countme = 0;
        let lotteryButtons = [];
        let selectedButtonId = null;
        let currentResult = null;
        
        // 初始化抽奖按钮
        function initLotteryButtons() {
            // 创建奖品池
            const prizes = [];
            for (let i = 0; i < 20; i++) prizes.push({ text: '中2元', value: 2 });
            for (let i = 0; i < 12; i++) prizes.push({ text: '中5元', value: 5 });
            for (let i = 0; i < 6; i++) prizes.push({ text: '中10元', value: 10 });
            for (let i = 0; i < 2; i++) prizes.push({ text: '中20元', value: 20 });
            for (let i = 0; i < 98; i++) prizes.push({ text: '马到成功', value: 0 });
            
            // 随机打乱
            for (let i = prizes.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [prizes[i], prizes[j]] = [prizes[j], prizes[i]];
            }
            
            // 创建138个按钮
            lotteryButtons = [];
            for (let i = 1; i <= 138; i++) {
                lotteryButtons.push({
                    id: i,
                    isClicked: false,
                    prize: prizes[i - 1].text,
                    prizeValue: prizes[i - 1].value
                });
            }
            
            renderLotteryGrid();
        }
        
        // 渲染抽奖网格
        function renderLotteryGrid() {
            const grid = document.getElementById('lotteryGrid');
            grid.innerHTML = '';
            
            // 第3-36排：每排4个，共136个
            for (let row = 0; row < 34; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'lottery-row';
                
                for (let col = 0; col < 4; col++) {
                    const buttonId = row * 4 + col + 1;
                    const btn = createLotteryButton(buttonId);
                    rowDiv.appendChild(btn);
                }
                
                grid.appendChild(rowDiv);
            }
            
            // 第37排：2个按钮
            const lastRow = document.createElement('div');
            lastRow.className = 'lottery-row';
            lastRow.appendChild(createLotteryButton(137));
            lastRow.appendChild(createLotteryButton(138));
            grid.appendChild(lastRow);
        }
        
        // 创建单个抽奖按钮
        function createLotteryButton(id) {
            const button = lotteryButtons.find(b => b.id === id);
            const btn = document.createElement('button');
            btn.className = `btn-lottery ${button.isClicked ? 'red' : 'green'}`;
            btn.textContent = id + '号';
            btn.disabled = button.isClicked;
            btn.onclick = () => handleLotteryClick(id);
            return btn;
        }
        
        // 显示密码弹窗
        function showPasswordModal() {
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordError').textContent = '';
            showModal('passwordModal');
            setTimeout(() => document.getElementById('passwordInput').focus(), 100);
        }
        // 显示密码弹窗2
        function showPasswordModal2() {
            document.getElementById('passwordInput2').value = '';
            document.getElementById('passwordError').textContent = '';
            showModal('passwordModal2');
            setTimeout(() => document.getElementById('passwordInput').focus(), 100);
        }
        // 检查密码
        function checkPassword() {
            const pwd = document.getElementById('passwordInput').value;
            if (pwd === 'xxhg*') {
                rechargeAmount = 0;
                winAmount = 0;
                countme = 0;
                updateDisplay();
                closeModal('passwordModal');
                document.getElementById('amountInput').value = '';
                document.getElementById('amountError').textContent = '';
                showModal('amountModal');
                setTimeout(() => document.getElementById('amountInput').focus(), 100);
            } else {
                document.getElementById('passwordError').textContent = '密码错误';
            }
        }
         // 检查密码2
        function checkPassword2() {
            const pwd = document.getElementById('passwordInput2').value;
            if (pwd === 'xxhg*') {
                closeModal('passwordModal2');
                document.getElementById('balance2').textContent = balance;
                showModal('jiezhangModal');
                setTimeout(() => document.getElementById('amountInput').focus(), 100);
            } else {
                document.getElementById('passwordError2').textContent = '密码错误';
            }
        }
        // 确认充值
        function confirmRecharge() {
            const amount = parseFloat(document.getElementById('amountInput').value);
            if (isNaN(amount) || amount <= 0) {
                document.getElementById('amountError').textContent = '请输入有效的金额';
                return;
            }
            rechargeAmount += amount;
            balance += amount;
            updateDisplay();
            closeModal('amountModal');
        }
        // 确认结账
        function confirmJiezhang() {
           rechargeAmount = 0;
           winAmount = 0;
           balance = 0;
           countme = 0;
            updateDisplay();
            closeModal('jiezhangModal');
        }
        
        // 处理抽奖点击
        function handleLotteryClick(buttonId) {
            const button = lotteryButtons.find(b => b.id === buttonId);
            if (!button || button.isClicked) return;
            
            if (balance < 2) {
                showModal('noBalanceModal');
                return;
            }
            
            selectedButtonId = buttonId;
            document.getElementById('confirmBalance').textContent = balance.toFixed(2);
            showModal('confirmLotteryModal');
        }
        
        // 执行抽奖
        function doLottery() {
            if (selectedButtonId === null) return;
            
            const button = lotteryButtons.find(b => b.id === selectedButtonId);
            if (!button) return;
            
            balance -= 2;
            countme += 1;
            currentResult = { text: button.prize, value: button.prizeValue };
            
            // 标记按钮为已点击
            button.isClicked = true;
            
            // 更新显示
            updateDisplay();
            renderLotteryGrid();
            
            closeModal('confirmLotteryModal');
            
            // 显示结果
            document.getElementById('resultText').textContent = currentResult.text;
            document.getElementById('resultBonus').textContent = currentResult.value > 0 ? `+${currentResult.value}元` : '';
            showModal('resultModal');
        }
        
        // 关闭结果弹窗
        function closeResult() {
            if (currentResult && currentResult.value > 0) {
                winAmount += currentResult.value;
                balance += currentResult.value;
                updateDisplay();
            }
            closeModal('resultModal');
            currentResult = null;
            selectedButtonId = null;
        }
        
        // 更新金额显示
        function updateDisplay() {
            document.getElementById('rechargeAmount').textContent = rechargeAmount;
            document.getElementById('winAmount').textContent = winAmount;
            document.getElementById('balance').textContent = balance;
            document.getElementById('countme').textContent = countme;
        }
        
        // 弹窗控制
        function showModal(id) {
            document.getElementById(id).classList.add('active');
        }
        
        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }
        
        // 点击遮罩关闭弹窗
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay && overlay.id !== 'resultModal' && overlay.id !== 'noBalanceModal') {
                    closeModal(overlay.id);
                }
            });
        });
        
        // 初始化
        initLotteryButtons();
    </script>
</body>
</html>
